#! /usr/bin/env lua

-- Copyright (C) 2015,2017,2018 Tomoyuki Fujimori <moyu@dromozoa.com>
--
-- This file is part of dromozoa-ubench.
--
-- dromozoa-ubench is free software: you can redistribute it and/or modify
-- it under the terms of the GNU General Public License as published by
-- the Free Software Foundation, either version 3 of the License, or
-- (at your option) any later version.
--
-- dromozoa-ubench is distributed in the hope that it will be useful,
-- but WITHOUT ANY WARRANTY; without even the implied warranty of
-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-- GNU General Public License for more details.
--
-- You should have received a copy of the GNU General Public License
-- along with dromozoa-ubench.  If not, see <http://www.gnu.org/licenses/>.

local ubench = require "dromozoa.ubench"

local filename, dir = ...

local results = assert(assert(loadfile(filename))())
local dataset = ubench.report(results, dir)

local version_max = 0
local name_max = 0

for i = 1, #dataset do
  local data = dataset[i]
  if version_max < #data.version then
    version_max = #data.version
  end
  if name_max < #data.name then
    name_max = #data.name
  end
end

local format = "%-" .. version_max .. "s | %-" .. name_max .. "s | %10.3f\n"
for i = 1, #dataset do
  local data = dataset[i]
  io.write(format:format(data.version, data.name, data.avg))
end
